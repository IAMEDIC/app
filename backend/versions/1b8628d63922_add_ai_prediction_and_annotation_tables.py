"""Add AI prediction and annotation tables

Revision ID: 1b8628d63922
Revises: 691bd50cc8aa
Create Date: 2025-09-23 03:54:02.746964

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '1b8628d63922'
down_revision = '691bd50cc8aa'
branch_labels = None
depends_on = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('picture_bb_annotations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('media_id', sa.UUID(), nullable=False),
    sa.Column('media_type', sa.Enum('image', 'video', name='bb_annotation_media_type'), nullable=False),
    sa.Column('bb_class', sa.String(length=100), nullable=False),
    sa.Column('usefulness', sa.Integer(), nullable=False),
    sa.Column('x_min', sa.Float(), nullable=False),
    sa.Column('y_min', sa.Float(), nullable=False),
    sa.Column('width', sa.Float(), nullable=False),
    sa.Column('height', sa.Float(), nullable=False),
    sa.Column('is_hidden', sa.Boolean(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint('usefulness IN (0, 1)', name='valid_bb_usefulness'),
    sa.ForeignKeyConstraint(['media_id'], ['media.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('media_id', 'bb_class', name='unique_media_bb_class_annotation')
    )
    op.create_index(op.f('ix_picture_bb_annotations_bb_class'), 'picture_bb_annotations', ['bb_class'], unique=False)
    op.create_index(op.f('ix_picture_bb_annotations_created_at'), 'picture_bb_annotations', ['created_at'], unique=False)
    op.create_index(op.f('ix_picture_bb_annotations_id'), 'picture_bb_annotations', ['id'], unique=False)
    op.create_index(op.f('ix_picture_bb_annotations_media_id'), 'picture_bb_annotations', ['media_id'], unique=False)
    op.create_index(op.f('ix_picture_bb_annotations_media_type'), 'picture_bb_annotations', ['media_type'], unique=False)
    op.create_table('picture_bb_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('media_id', sa.UUID(), nullable=False),
    sa.Column('media_type', sa.Enum('image', 'video', name='bb_prediction_media_type'), nullable=False),
    sa.Column('bb_class', sa.String(length=100), nullable=False),
    sa.Column('confidence', sa.Float(), nullable=False),
    sa.Column('x_min', sa.Float(), nullable=False),
    sa.Column('y_min', sa.Float(), nullable=False),
    sa.Column('width', sa.Float(), nullable=False),
    sa.Column('height', sa.Float(), nullable=False),
    sa.Column('model_version', sa.String(length=255), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['media_id'], ['media.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('media_id', 'model_version', 'bb_class', name='unique_media_model_bb_class')
    )
    op.create_index(op.f('ix_picture_bb_predictions_bb_class'), 'picture_bb_predictions', ['bb_class'], unique=False)
    op.create_index(op.f('ix_picture_bb_predictions_created_at'), 'picture_bb_predictions', ['created_at'], unique=False)
    op.create_index(op.f('ix_picture_bb_predictions_id'), 'picture_bb_predictions', ['id'], unique=False)
    op.create_index(op.f('ix_picture_bb_predictions_media_id'), 'picture_bb_predictions', ['media_id'], unique=False)
    op.create_index(op.f('ix_picture_bb_predictions_media_type'), 'picture_bb_predictions', ['media_type'], unique=False)
    op.create_index(op.f('ix_picture_bb_predictions_model_version'), 'picture_bb_predictions', ['model_version'], unique=False)
    op.create_table('picture_classification_annotations',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('media_id', sa.UUID(), nullable=False),
    sa.Column('media_type', sa.Enum('image', 'video', name='annotation_media_type'), nullable=False),
    sa.Column('usefulness', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.CheckConstraint('usefulness IN (0, 1)', name='valid_usefulness'),
    sa.ForeignKeyConstraint(['media_id'], ['media.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_picture_classification_annotations_created_at'), 'picture_classification_annotations', ['created_at'], unique=False)
    op.create_index(op.f('ix_picture_classification_annotations_id'), 'picture_classification_annotations', ['id'], unique=False)
    op.create_index(op.f('ix_picture_classification_annotations_media_id'), 'picture_classification_annotations', ['media_id'], unique=True)
    op.create_index(op.f('ix_picture_classification_annotations_media_type'), 'picture_classification_annotations', ['media_type'], unique=False)
    op.create_table('picture_classification_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('media_id', sa.UUID(), nullable=False),
    sa.Column('media_type', sa.Enum('image', 'video', name='prediction_media_type'), nullable=False),
    sa.Column('prediction', sa.Float(), nullable=False),
    sa.Column('model_version', sa.String(length=255), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=False),
    sa.ForeignKeyConstraint(['media_id'], ['media.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('media_id', 'model_version', name='unique_media_model_classification')
    )
    op.create_index(op.f('ix_picture_classification_predictions_created_at'), 'picture_classification_predictions', ['created_at'], unique=False)
    op.create_index(op.f('ix_picture_classification_predictions_id'), 'picture_classification_predictions', ['id'], unique=False)
    op.create_index(op.f('ix_picture_classification_predictions_media_id'), 'picture_classification_predictions', ['media_id'], unique=False)
    op.create_index(op.f('ix_picture_classification_predictions_media_type'), 'picture_classification_predictions', ['media_type'], unique=False)
    op.create_index(op.f('ix_picture_classification_predictions_model_version'), 'picture_classification_predictions', ['model_version'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_picture_classification_predictions_model_version'), table_name='picture_classification_predictions')
    op.drop_index(op.f('ix_picture_classification_predictions_media_type'), table_name='picture_classification_predictions')
    op.drop_index(op.f('ix_picture_classification_predictions_media_id'), table_name='picture_classification_predictions')
    op.drop_index(op.f('ix_picture_classification_predictions_id'), table_name='picture_classification_predictions')
    op.drop_index(op.f('ix_picture_classification_predictions_created_at'), table_name='picture_classification_predictions')
    op.drop_table('picture_classification_predictions')
    op.drop_index(op.f('ix_picture_classification_annotations_media_type'), table_name='picture_classification_annotations')
    op.drop_index(op.f('ix_picture_classification_annotations_media_id'), table_name='picture_classification_annotations')
    op.drop_index(op.f('ix_picture_classification_annotations_id'), table_name='picture_classification_annotations')
    op.drop_index(op.f('ix_picture_classification_annotations_created_at'), table_name='picture_classification_annotations')
    op.drop_table('picture_classification_annotations')
    op.drop_index(op.f('ix_picture_bb_predictions_model_version'), table_name='picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_predictions_media_type'), table_name='picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_predictions_media_id'), table_name='picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_predictions_id'), table_name='picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_predictions_created_at'), table_name='picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_predictions_bb_class'), table_name='picture_bb_predictions')
    op.drop_table('picture_bb_predictions')
    op.drop_index(op.f('ix_picture_bb_annotations_media_type'), table_name='picture_bb_annotations')
    op.drop_index(op.f('ix_picture_bb_annotations_media_id'), table_name='picture_bb_annotations')
    op.drop_index(op.f('ix_picture_bb_annotations_id'), table_name='picture_bb_annotations')
    op.drop_index(op.f('ix_picture_bb_annotations_created_at'), table_name='picture_bb_annotations')
    op.drop_index(op.f('ix_picture_bb_annotations_bb_class'), table_name='picture_bb_annotations')
    op.drop_table('picture_bb_annotations')
    # ### end Alembic commands ###